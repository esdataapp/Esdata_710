# Configuración del Sistema de Orquestación de Scraping
# Rutas relativas al directorio principal del proyecto (esdata_run)

# Modo de prueba para aislar la ejecución de scrapers
test_mode:
  enabled: true
  scraper_to_test: "inm24" # Scraper a probar (ej. "inm24", "cyt")

# Mapeo de nombres de CSV a códigos internos
website_mapping:
  "inmuebles24": "inm24"
  "casasyterrenos": "cyt"
  "lamudi": "lam"
  "metroscubicos": "mit"
  "propiedades": "prop"
  "trovit": "tro"

# Configuraciones específicas por scraper
scraper_settings:
  inm24:
    # Inmuebles24 es sensible y a menudo presenta captchas de Cloudflare.
    # Requiere una GUI (real o virtual como xvfb) para que seleniumbase
    # pueda intentar resolver el captcha haciendo clic en él.
    requires_gui: true
  inm24_det:
    requires_gui: true
  
  # Por defecto, los demás scrapers pueden funcionar en modo headless.
  lam:
    requires_gui: false
  lam_det:
    requires_gui: false
  cyt:
    requires_gui: false
  mit:
    requires_gui: false
  prop:
    requires_gui: false
  tro:
    requires_gui: false

# Configuración de directorios. Las rutas son relativas a la raíz del proyecto.
data:
  urls_path: "urls"
  logs_path: "logs"
  temp_path: "temp"

# Configuración de base de datos
database:
  path: "esdata_run/orchestrator.db" # Ruta desde la raíz del proyecto
  backup_path: "backups"
  backup_retention_days: 30

# Configuración de scrapers
scrapers:
  base_path: "esdata_run/scrapers"
  # Mapeo de nombres de scraper a archivos de script
  scripts:
    inm24: "inm24.py"
    inm24_det: "inm24_det.py"
    cyt: "cyt.py"
    lam: "lam.py"
    lam_det: "lam_det.py"
    mit: "mit.py"
    prop: "prop.py"
    tro: "tro.py"
  python_executable: "python3"
  timeout_minutes: 60 # Aumentado para robustez
  memory_limit_mb: 1024

# Configuración de ejecución
execution:
  max_parallel_scrapers: 4 # Reducido para estabilidad inicial (1 Inm24 + 3 rotativos)
  retry_delay_minutes: 30
  execution_interval_days: 15
  rate_limit_delay_seconds: 5 # Aumentado para evitar bloqueos
  max_retry_attempts: 3
  enable_auto_recovery: true
  single_url_task_per_scraper: false
  
# Configuración de monitoreo
monitoring:
  enable_metrics: true
  enable_alerts: false # Deshabilitado por ahora
  check_interval_seconds: 300

# Configuración de sitios web
websites:
  inm24:
    priority: 1
    has_detail_scraper: true
    detail_scraper_name: "inm24_det"
    base_url: "https://inmuebles24.com"
    rate_limit_seconds: 5
    user_agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
    max_pages_per_session: 20 # Reducido para evitar bloqueos
    
  cyt:
    priority: 2
    has_detail_scraper: false
    base_url: "https://casasyterrenos.com"
    rate_limit_seconds: 3
    user_agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
    max_pages_per_session: 30
    
  lam:
    priority: 3
    has_detail_scraper: true
    detail_scraper_name: "lam_det"
    base_url: "https://lamudi.com.mx"
    rate_limit_seconds: 4
    user_agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
    max_pages_per_session: 25
    
  mit:
    priority: 4
    has_detail_scraper: false
    base_url: "https://mitula.com.mx"
    rate_limit_seconds: 2
    user_agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
    max_pages_per_session: 40
    
  prop:
    priority: 5
    has_detail_scraper: false
    base_url: "https://propiedades.com"
    rate_limit_seconds: 3
    user_agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
    max_pages_per_session: 30
    
  tro:
    priority: 6
    has_detail_scraper: false
    base_url: "https://trovit.com.mx"
    rate_limit_seconds: 2
    user_agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
    max_pages_per_session: 40

# Configuración de logging
logging:
  level: "INFO"
  max_file_size_mb: 50
  backup_count: 5
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

# Variables de entorno
environment:
  debug_mode: true
  enable_profiling: false
